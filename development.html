<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>퓨처스 스케줄</title>
    <style>
      /* 1. 폰트 등록 */
      @font-face {
        font-family: "Eagles-Bold";
        src: url("Fonts/HanwhaEagles-Regular.ttf") format("truetype");
        font-weight: normal;
      }
      @font-face {
        font-family: "Eagles-Gothic";
        src: url("Fonts/06HANWHAGOTHICL.TTF") format("truetype");
        font-weight: normal;
      }

      /* 2. 전체 레이아웃 */
      body {
        margin: 0;
        padding: 8px;
        background-color: #f5f5f7;
        font-family: "Eagles-Gothic", sans-serif;
        -webkit-font-smoothing: antialiased;
        position: relative; /* 유니폼 배치를 위해 추가 */
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
      }

      /* 3. 우측 상단 유니폼 사진 컨테이너 */
      .uniform-container {
        position: absolute;
        top: 0px;
        right: 10px;
        z-index: 100;
        display: flex; /* 가로 정렬을 위한 설정 */
        align-items: center; /* 세로 중앙 정렬 */
        gap: 15px; /* 텍스트와 사진 사이 간격 */
      }

      /* 유니폼 타이틀 스타일 */
      .uniform-title {
        font-family: "Eagles-Bold", sans-serif;
        font-size: 1.8rem;
        color: rgb(8, 30, 60);
        border-left: 4px solid rgb(8, 30, 60);
        /* 3. 위쪽 padding을 0으로 주면 글자가 더 위로 붙습니다 */
        padding: 0px 0px 0px 10px;
        background-color: rgba(255, 255, 255, 0.5);
        white-space: nowrap;
        line-height: 1; /* 4. 줄간격을 최소화해서 위 공간 삭제 */
      }

      /* 유니폼 이미지 크기 및 효과 */
      #uniform-img {
        width: 130px; /* 원하는 크기로 조절하세요 */
        height: auto;
        display: none;
        filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.15));
      }

      /* 4. 상단 헤더 컨테이너 */
.schedule-header-container {
  margin-bottom: 15px;
  padding: 5px 15px;
  border-left: 6px solid rgb(252, 78, 0);
}

.main-title {
  font-family: "Eagles-Bold", sans-serif;
  font-size: 2.8rem;
  color: rgb(28, 30, 60);
  margin: 0 0 10px 0; /* 아래쪽 여백 추가 */
}

/* 날씨와 버튼을 가로로 정렬하는 컨테이너 */
.info-bar {
  display: flex;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap; /* 화면 좁아지면 자연스럽게 줄바꿈 */
}

.weather-info {
  font-size: 1.1rem;
  color: #444;
  display: flex;
  align-items: center;
}

/* 5. 갱신 버튼 스타일 (날씨 옆 배지 스타일) */
.status-btn {
  cursor: pointer;
  border: none;
  border-radius: 50px;
  padding: 8px 100px; 
  font-family: "Eagles-Bold", sans-serif;
  font-size: 1.4rem;
  transition: all 0.3s ease;
  background-color: #e0e0e0;
  color: #666;
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.status-btn.updated {
  background-color: rgb(28, 30, 60);
  color: white;
}
      .tomorrow-badge {
        background-color: #333;
        color: white;
        font-size: 1rem;
        padding: 5px 10px;
        border-radius: 50px;
        border: 1px solid rgb(8, 30, 60);
      }

      .weather-info {
        font-size: 1.1rem;
        color: #666;
        margin-top: 5px;
      }
      .weather-tag {
        background-color: #eee;
        padding: 3px 10px;
        border-radius: 4px;
        margin-right: 5px;
      }

      /* 4. 표 스타일 - 화면 높이에 맞게 가변 설정 */
      #display {
        height: 90%; /* 화면 높이의 약 70%를 표가 차지하도록 설정 */
        display: flex;
      }

      table {
        width: 100%;
        height: 100%; /* 부모(#display) 높이를 가득 채움 */
        border-collapse: collapse;
        table-layout: fixed;
        background: white;
      }

      td {
        border: 1px solid #444;
        padding: 3px;
        text-align: center;
        font-size: 1.2rem;
        /* 핵심: 행이 적으면 높이를 늘리고, 많으면 줄어들게 함 */
        height: auto;
      }

      /* 제목 행(투수/야수)은 너무 늘어나지 않게 적당한 높이 유지 */
      .main-header {
        height: 37px;
        font-family: "Eagles-Bold", sans-serif;
        background-color: rgb(8, 30, 60);
        color: rgb(252, 78, 0);
        font-size: 2.1rem;
      }

      .col-time {
        background-color: rgb(235, 235, 235);
        font-weight: bold;
      }
      .col-content {
        text-align: left;
        padding-left: 20px;
      }
      .center-line {
        border-right: 3px solid #333 !important;
      }
      .player-list-cell {
        background-color: rgb(240, 240, 240);
        letter-spacing: 2px;
      }

      /* 하단 버튼 컨테이너 */
      .bottom-link-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 5px;
        margin-bottom: 5px;
      }

      .nav-btn {
        text-decoration: none;
        color: #ffffff;
        padding: 7px 0;
        width: 400px; /* 버튼 너비를 균일하게 설정 */
        text-align: center;
        border-radius: 10px;
        font-size: 1.2rem;
        font-family: "Eagles-Bold", sans-serif;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      }

      .btn-futures {
        background-color: rgb(252, 78, 0);
      } /* 오렌지 */
      .btn-development {
        background-color: rgb(28, 30, 60);
      } /*네이비 */
      .btn-monthly {
        background-color: rgb(237, 219, 180);
        color: rgb(252, 78, 0);
      } /* 아이보리 */

      .nav-btn:hover {
        transform: translateY(-3px);
        filter: brightness(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      }

      /* 버튼 스타일 (rionic14님의 설정 반영) */
      .development-btn {
        text-decoration: none;
        color: #ffffff;
        background-color: rgb(252, 78, 0); /* 딥 네이비 */
        padding: 4px 200px;
        border-radius: 10px; /* 더 둥글게 */
        font-size: 1.3rem;
        font-family: "Eagles-Bold", sans-serif;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .development-btn:hover {
        background-color: rgb(8, 30, 60); /* 한화 오렌지 */
        transform: translateY(-3px); /* 살짝 떠오르는 효과 */
        box-shadow: 0 6px 20px rgba(8, 30, 60, 0.3);
      }
    </style>
  </head>
  <body>
   <div class="schedule-header-container">
  <h1 id="date-text" class="main-title">SCHEDULE</h1>

  <div class="info-bar">
    <div id="weather-display" class="weather-info">
      서산 날씨 확인 중...
    </div>
    <button id="update-btn" class="status-btn" onclick="toggleStatus()">
      스케줄 갱신 전
    </button>
  </div>
</div>
      <div id="display"></div>
    </div>
    <div id="display"></div>

    <div class="bottom-link-container">
      <a href="index.html" class="nav-btn btn-futures"> 퓨처스 스케줄 보기 </a>
      <a href="monthly.html" class="nav-btn btn-monthly"> 월간 스케줄 보기 </a>
    </div>

    <script>
      /**
       * 1. 상태 갱신 (development-status.txt)
       * 내용이 '0'이면 무조건 비활성, 그 외엔 수정 후 12시간 유지
       */

      async function updateStatusLabel() {
        const btn = document.getElementById("update-btn");
        if (!btn) return;

        try {
          // 1. development.csv 파일의 정보(헤더)만 가져옵니다.
          // t= 파라미터는 서버의 최신 상태를 즉시 반영하기 위한 캐시 방지용입니다.
          const response = await fetch(
            "development.csv?t=" + new Date().getTime(),
            {
              method: "HEAD",
            },
          );

          if (!response.ok) return;

          // 2. 파일의 최종 수정 시간을 계산합니다.
          const lastModified = new Date(response.headers.get("Last-Modified"));
          const diffInHours = (new Date() - lastModified) / (1000 * 60 * 60);

          // 3. 12시간 룰 적용
          if (diffInHours >= 0 && diffInHours <= 12) {
            btn.classList.add("updated");
            btn.innerText = "스케줄 갱신 완료 ✓";
          } else {
            btn.classList.remove("updated");
            btn.innerText = "스케줄 갱신 전";
          }
        } catch (e) {
          console.error("상태 로딩 실패:", e);
        }
      }

      /**
       * 2. 날씨 정보 (서산)
       */
      async function updateWeatherOnly() {
        const API_KEY = "cbdcecd908e8704e65f974ca31c52b4e";
        const cityId = "Seosan,kr";
        const weatherDisplay = document.getElementById("weather-display");

        try {
          const res = await fetch(
            `https://api.openweathermap.org/data/2.5/forecast?q=${cityId}&appid=${API_KEY}&units=metric`,
          );
          const data = await res.json();

          const todayForecasts = data.list.slice(0, 8);
          const maxTemp = Math.round(
            Math.max(...todayForecasts.map((item) => item.main.temp_max)),
          );
          const icon = data.list[0].weather[0].icon;

          weatherDisplay.innerHTML = `
      <div class="weather-item" style="display: inline-block; margin-right: 15px; vertical-align: middle;">
          <span class="city-name" style="font-weight: bold;">서산 낮기온 예상</span>
          <span class="max-temp" style="color: #ff6600; font-size: 1.5rem;">${maxTemp}°</span>
          <div style="display: inline-flex; align-items: center; justify-content: center; background-color: rgb(156, 218, 255); width: 40px; height: 40px; border-radius: 50%; margin-left: 5px; vertical-align: middle;">
            <img src="https://openweathermap.org/img/wn/${icon}@2x.png" style="width: 40px; height: 40px;">
          </div>
        </div>`;
        } catch (error) {
          console.error("날씨 실패:", error);
        }
      }

      /**
       * 3. 유니폼 이미지
       */
      async function loadUniformImage(targetDate) {
        const imgElement = document.getElementById("uniform-img");
        try {
          const res = await fetch("uniforms/uniform.csv");
          const data = await res.text();
          const match = data
            .trim()
            .split("\n")
            .find((row) => row.startsWith(targetDate));
          if (match) {
            imgElement.src = `uniforms/${match.split(",")[1].trim()}`;
            imgElement.style.display = "inline-block";
          }
        } catch (e) {
          console.error("유니폼 로드 실패");
        }
      }

      /**
       * 4. 메인 실행 (표 그리기 포함)
       */
      async function run() {
        const now = new Date();
        const hours = now.getHours();
        let displayDate = new Date(now);

        if (hours >= 18) displayDate.setDate(now.getDate() + 1);

        const dateStr = displayDate.toISOString().split("T")[0];

        // 헤더 및 배지 영역 초기화
        document.getElementById("date-text").innerText =
          `${dateStr} DEVELOPMENT SCHEDULE`;
        const badgeArea = document.getElementById("badge-area");
        if (badgeArea) badgeArea.innerHTML = "";

        // 비동기 데이터 로드
        updateWeatherOnly();
        loadUniformImage(dateStr);
        updateStatusLabel();

        // 표 그리기
        try {
          const res = await fetch("development.csv?t=" + new Date().getTime());
          const csvData = await res.text();
          const rows = csvData.trim().split("\n");

          let html = `<table><colgroup><col style="width: 8%;"><col style="width: 42%;"><col style="width: 8%;"><col style="width: 42%;"></colgroup>`;

          rows.forEach((row, index) => {
            const cols = row.split(",");
            html += "<tr>";
            if (index === 0) {
              html += `<td colspan="2" class="main-header center-line">${cols[0] || "투수"}</td>`;
              html += `<td colspan="2" class="main-header">${cols[2] || "야수"}</td>`;
            } else if (index === rows.length - 1) {
              html += `<td class="col-time">${cols[0] || "기타"}</td><td colspan="3" class="col-content">${cols[1] || ""}</td>`;
            } else {
              cols.forEach((col, colIndex) => {
                const isPlayer = col.includes("선수명단");
                const cellClass = isPlayer
                  ? "player-list-cell"
                  : colIndex % 2 === 0
                    ? "col-time"
                    : "col-content";
                html += `<td class="${cellClass} ${colIndex === 1 ? "center-line" : ""}">${col || ""}</td>`;
              });
            }
            html += "</tr>";
          });
          document.getElementById("display").innerHTML = html + "</table>";
        } catch (e) {
          document.getElementById("display").innerHTML = "<p>CSV 로드 실패</p>";
        }
      }

      run();
    </script>
  </body>
</html>
