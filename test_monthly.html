<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>K 스케줄 - 스마트 모달 통합 에디션</title>
    <style>
      @font-face {
        font-family: "Eagles-Bold";
        src: url("Fonts/HanwhaEagles-Regular.ttf") format("truetype");
      }
      @font-face {
        font-family: "Eagles-Gothic";
        src: url("Fonts/06HANWHAGOTHICL.TTF") format("truetype");
      }
      @font-face {
        font-family: "NotoSansJP-Bold";
        src: url("Fonts/NotoSansJP-Bold.ttf") format("truetype");
      }

      body {
        background-color: #f8f9fa;
        font-family: "Eagles-Gothic", sans-serif;
        padding: 0;
        margin: 0;
      }

      /* 헤더 상단 고정 */
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgb(217, 217, 217);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .top-nav-bar {
        display: flex;
        max-width: 1400px;
        margin: 0 auto;
        padding: 10px 10px 5px 10px;
        gap: 10px;
      }
      .top-nav-btn {
        flex: 1;
        text-decoration: none;
        padding: 10px 0;
        border-radius: 6px;
        text-align: center;
        font-family: "Eagles-Bold";
        font-size: 3rem;
        color: white;
        transition: all 0.2s;
      }
      .btn-futures {
        background-color: rgb(252, 78, 0);
      }
      .btn-dev {
        background-color: rgb(28, 30, 60);
      }
      .top-nav-btn:hover {
        filter: brightness(1.2);
        transform: scale(1.01);
      }

      .days-header {
        display: flex;
        max-width: 1400px;
        margin: 0 auto;
        color: rgb(0, 0, 0);
        padding-left: 35px;
        font-family: "NotoSansJP-Bold";
        text-align: center;
      }
      .header-slot {
        flex: 1;
        padding: 12px 0;
        border-right: 1px solid rgb(217, 217, 217);
        font-size: 2.6rem;
      }

      /* 메인 컨테이너 */
      .container {
        max-width: 1400px;
        margin: 20px auto;
        padding: 0 10px;
      }
      .week-block {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 25px;
        border: 1px solid #ddd;
        overflow: hidden;
      }

      .team-row {
        display: flex;
        border-bottom: 1px solid #eee;
        min-height: 150px;
        position: relative;
      }
      .team-label {
        width: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Eagles-Bold";
        color: white;
        flex-shrink: 0;
        font-size: 1.9rem;
        z-index: 20;
      }
      .futures-row {
        background-color: rgb(254, 231, 228);
      }
      .futures-label {
        background-color: rgb(252, 78, 0);
      }
      .dev-row {
        background-color: rgb(230, 230, 255);
      }
      .dev-label {
        background-color: rgb(28, 30, 60);
      }

      .day-slots {
        display: flex;
        flex-grow: 1;
        width: calc(100% - 35px);
        align-items: stretch;
      }
      .day-slot {
        flex: 1;
        border-right: 1px solid hsla(0, 0%, 0%, 0.1);
        padding: 12px 10px;
        min-width: 0;
        position: relative;
        height: 150px;
        overflow: hidden;
        cursor: pointer;
        transition: background 0.2s;
      }
      .day-slot:hover {
        background-color: rgba(0, 0, 0, 0.03);
      }
      .day-slot.today {
        background-color: rgba(255, 255, 255, 0.7);
        outline: 2px solid #ff6600;
        outline-offset: -2px;
      }

      .date-label {
        font-size: 1.8rem;
        color: #474747;
        font-weight: bold;
        margin-bottom: 8px;
        text-align: center;
        display: block;
      }

      /* 평상시 텍스트 설정 (한 줄 처리) */
      .event-content {
        text-align: center;
        margin-bottom: 12px;
      }
      .event-title,
      .event-info,
      .event-desc {
        display: block;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        width: 100%;
      }
      .event-title {
        font-weight: 800;
        font-size: 1.54rem;
        margin-bottom: 2px;
      }
      .event-info {
        font-weight: 600;
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 2px;
      }
      .event-desc {
        font-size: 1.1rem;
        opacity: 0.75;
        border-top: 1px dashed rgba(0, 0, 0, 0.1);
        padding-top: 3px;
        margin-bottom: 10px;
      }

      /* [핵심] 모달 전체 화면 설정 */
      #modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        backdrop-filter: blur(8px);
      }
      #modal-content {
        background: white;
        width: 70vw;
        height: 90vh;
        border-radius: 24px;
        padding: 40px;
        box-sizing: border-box;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6);
      }

      /* 모달 내 이벤트 구분 및 중앙 정렬 */
      #modal-content .event-content {
        width: 100%;
        padding: 30px 0;
        border-bottom: 2px solid #eee; /* 복수 이벤트 시 실선 구분 */
        display: flex;
        flex-direction: column;
        align-items: left;
        justify-content: left;
      }
      #modal-content .event-content:last-child {
        border-bottom: none;
      }

      /* 모달 안 텍스트 크기 및 줄바꿈 복구 */
      #modal-content .event-title, 
      #modal-content .event-info, 
      #modal-content .event-desc {
        white-space: normal; 
        overflow: visible; 
        line-height: 1.3;
      }

      #modal-content .event-title { font-size: 3rem; margin-bottom: 15px; }
      #modal-content .event-info { font-size: 2.2rem; margin-bottom: 15px; }

      /* [수정 포인트] Desc 부분: 모든 형태의 줄바꿈 반영 */
      #modal-content .event-desc { 
        font-family: "NotoSansJP-Bold", sans-serif; 
        font-size: 1.8rem; 
        border-top: 2px dashed rgba(0,0,0,0.1); 
        padding-top: 20px; 
        width: 85%; 
        white-space: pre-wrap;  /* 엔터 및 공백 모두 그대로 표시 */
        word-break: break-word; /* 너무 긴 단어는 자동 줄바꿈 */
        text-align: left;     /* 중앙 정렬 유지 */
      }
      /* 색상 테마 */
      .text-orange {
        color: rgb(252, 78, 0) !important;
      }
      .text-navy {
        color: rgb(23, 35, 207) !important;
      }
      .text-green {
        color: rgb(140, 210, 70) !important;
      }
      .text-blue {
        color: rgb(0, 190, 210) !important;
      }
      .text-red {
        color: rgb(255, 0, 0) !important;
      }

      /* 넘침 표시용 도트 (선택 사항) */
      .day-slot.has-overflow::after {
        content: "●●●";
        position: absolute;
        bottom: 5px;
        width: 100%;
        text-align: center;
        font-size: 8px;
        color: rgba(0, 0, 0, 0.2);
        letter-spacing: 2px;
      }
    </style>
  </head>
  <body>
    <div id="modal-overlay" onclick="closeModal()">
      <div id="modal-content" onclick="event.stopPropagation()"></div>
    </div>

    <div class="sticky-header">
      <div class="top-nav-bar">
        <a href="futures.html" class="top-nav-btn btn-futures">퓨처스 스케줄</a>
        <a href="development.html" class="top-nav-btn btn-dev">육성군 스케줄</a>
      </div>
      <div class="days-header">
        <div class="header-slot" style="color: #ff0019">日</div>
        <div class="header-slot">月</div>
        <div class="header-slot">火</div>
        <div class="header-slot">水</div>
        <div class="header-slot">木</div>
        <div class="header-slot">金</div>
        <div class="header-slot" style="color: #2010ff">土</div>
      </div>
    </div>

    <div class="container" id="schedule-container">
      <div
        id="loading"
        style="
          text-align: center;
          padding: 50px;
          font-family: &quot;Eagles-Bold&quot;;
          color: #ff6600;
        "
      >
        데이터 로딩 중...
      </div>
    </div>

    <script>
      const API_KEY = "AIzaSyAluwiwfHMYHBoAZe5EAXAiejet-s_Pwl8";
      const CALENDARS = [
        {
          id: "0e62092f3ac04d780ab1cccccb428e2119f2823be6f59112cc0e427d843a0695@group.calendar.google.com",
          name: "F",
          rowClass: "futures-row",
          labelClass: "futures-label",
        },
        {
          id: "ca9502e51d0b0bd07eaa8ab7dbbc3925b69576439b0642b072dc79015eed8d11@group.calendar.google.com",
          name: "D",
          rowClass: "dev-row",
          labelClass: "dev-label",
        },
      ];

      // 모달 제어
      function openModal(slotId) {
        const slot = document.getElementById(slotId);
        const content = slot.querySelector(".slot-content").innerHTML;
        if (!content.trim()) return;

        const modalContent = document.getElementById("modal-content");
        modalContent.innerHTML = content;
        document.getElementById("modal-overlay").style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        document.getElementById("modal-overlay").style.display = "none";
        document.body.style.overflow = "auto";
      }

      function formatTime(dateTimeStr) {
        if (!dateTimeStr) return "";
        const date = new Date(dateTimeStr);
        return `${String(date.getHours()).padStart(2, "0")}:${String(date.getMinutes()).padStart(2, "0")}`;
      }

      async function fetchEvents(calId, start, days) {
        const end = new Date(start);
        end.setDate(start.getDate() + days);
        const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calId)}/events?key=${API_KEY}&timeMin=${start.toISOString()}&timeMax=${end.toISOString()}&singleEvents=true&orderBy=startTime`;
        try {
          const response = await fetch(url);
          const data = await response.json();
          return data.items || [];
        } catch (e) {
          return [];
        }
      }

      function getConditionClass(text) {
        if (text.includes("휴")) return "text-red";
        if (text.includes("-한화")) return "text-orange";
        if (text.includes("한화-")) return "text-navy";
        if (text.includes("미정")) return "text-green";
        if (text.includes("이동")) return "text-blue";
        return "";
      }

      async function renderSchedule() {
        const d = new Date();
        const diff = d.getDate() - d.getDay();
        const baseSunday = new Date(d.setDate(diff));
        baseSunday.setHours(0, 0, 0, 0);

        const container = document.getElementById("schedule-container");
        const [futures, dev] = await Promise.all([
          fetchEvents(CALENDARS[0].id, baseSunday, 42),
          fetchEvents(CALENDARS[1].id, baseSunday, 42),
        ]);

        container.innerHTML = "";

        for (let w = 0; w < 6; w++) {
          const weekStart = new Date(baseSunday);
          weekStart.setDate(baseSunday.getDate() + w * 7);
          const weekBlock = document.createElement("div");
          weekBlock.className = "week-block";

          [futures, dev].forEach((events, idx) => {
            const cal = CALENDARS[idx];
            const row = document.createElement("div");
            row.className = `team-row ${cal.rowClass}`;
            let rowHtml = `<div class="team-label ${cal.labelClass}">${cal.name}</div><div class="day-slots">`;

            for (let i = 0; i < 7; i++) {
              const currentDay = new Date(weekStart);
              currentDay.setDate(weekStart.getDate() + i);
              const slotId = `slot-${idx}-${w}-${i}`;
              const isToday =
                currentDay.toDateString() === new Date().toDateString()
                  ? "today"
                  : "";
              const dayEvents = events.filter(
                (e) =>
                  new Date(e.start.date || e.start.dateTime).toDateString() ===
                  currentDay.toDateString(),
              );
              const dateLabelHtml =
                idx === 0
                  ? `<span class="date-label">${currentDay.getMonth() + 1}/${currentDay.getDate()}</span>`
                  : "";

              rowHtml += `<div class="day-slot ${isToday}" id="${slotId}" onclick="openModal('${slotId}')">
                            ${dateLabelHtml}
                            <div class="slot-content">`;

              dayEvents.forEach((e) => {
                const titleText = e.summary || "";
                const startTime = formatTime(e.start.dateTime);
                const infoText =
                  (e.location || "") + (startTime ? ` [${startTime}]` : "");
                const cClass = getConditionClass(titleText);

                rowHtml += `<div class="event-content ${cClass}">
                              <span class="event-title">${titleText}</span>
                              ${infoText ? `<span class="event-info">${infoText}</span>` : ""}
                              ${e.description ? `<span class="event-desc">${e.description}</span>` : ""}
                            </div>`;
              });
              rowHtml += `</div></div>`;
            }
            rowHtml += `</div>`;
            row.innerHTML = rowHtml;
            weekBlock.appendChild(row);

            // 넘침 체크
            setTimeout(() => {
              const slots = row.querySelectorAll(".day-slot");
              slots.forEach((slot) => {
                if (slot.querySelector(".slot-content").scrollHeight > 135)
                  slot.classList.add("has-overflow");
              });
            }, 300);
          });
          container.appendChild(weekBlock);
        }
      }
      renderSchedule();
    </script>
  </body>
</html>
